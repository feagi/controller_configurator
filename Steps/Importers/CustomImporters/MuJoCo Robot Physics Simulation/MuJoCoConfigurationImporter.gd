extends BaseConfigImporter
class_name MuJoCoConfigurationImporter

var _failure: Control
var _success: Control
var _error_code: Label
var _continue: Button
var _tree: TreeSkeletonExplorer

func _ready() -> void:
	_failure = $Failure
	_success = $Success
	_error_code = $Failure/error
	_continue = $Options/Continue
	_tree = $Success/HBoxContainer/Import/tree

## This should return the expected file extension as a string
func get_expected_file_extension() -> StringName:
	return "xml"

## Called on UI startup. Loads the raw bytes of the data. Make sure to verify data to be valid
func load_input_data(data: PackedByteArray, feagi_template: FEAGIRobotConfigurationTemplateHolder, _file_name: StringName) -> void:
	
	var root_node: TreeItem = _tree.create_item()
	
	## TEMP
	var recurse: Array = [{"name": "torso", "type": "body", "subtype": "body", "properties": {"name": "torso", "pos": "0 0 1.282", "childclass": "body"}, "description": "", "children": [{"name": "top", "type": "light", "subtype": "light", "properties": {"name": "top", "pos": "0 0 2", "mode": "trackcom"}, "description": "", "children": []}, {"name": "back", "type": "camera", "subtype": "camera", "properties": {"name": "back", "pos": "-3 0 1", "xyaxes": "0 -1 0 1 0 2", "mode": "trackcom"}, "description": "", "children": []}, {"name": "side", "type": "camera", "subtype": "camera", "properties": {"name": "side", "pos": "0 -3 1", "xyaxes": "1 0 0 0 1 2", "mode": "trackcom"}, "description": "", "children": []}, {"name": "root", "type": "freejoint", "subtype": "freejoint", "properties": {"name": "root"}, "description": "", "children": []}, {"name": "torso", "type": "geom", "subtype": "geom", "properties": {"name": "torso", "fromto": "0 -.07 0 0 .07 0", "size": ".07"}, "description": "", "children": []}, {"name": "waist_upper", "type": "geom", "subtype": "geom", "properties": {"name": "waist_upper", "fromto": "-.01 -.06 -.12 -.01 .06 -.12", "size": ".06"}, "description": "", "children": []}, {"name": "head", "type": "body", "subtype": "body", "properties": {"name": "head", "pos": "0 0 .19"}, "description": "", "children": [{"name": "head", "type": "geom", "subtype": "geom", "properties": {"name": "head", "type": "sphere", "size": ".09"}, "description": "", "children": []}, {"name": "head_gyro_mount", "type": "site", "subtype": "site", "properties": {"name": "head_gyro_mount", "pos": "0 0 0", "size": "0.01"}, "description": "", "children": []}, {"name": "egocentric", "type": "camera", "subtype": "camera", "properties": {"name": "egocentric", "pos": ".09 0 0", "xyaxes": "0 -1 0 .1 0 1", "fovy": "80"}, "description": "", "children": []}, {"name": null, "type": "replicate", "subtype": "replicate", "properties": {"count": "16", "euler": "0 4 0"}, "description": "", "children": [{"name": null, "type": "replicate", "subtype": "replicate", "properties": {"count": "16", "euler": "0 0 4"}, "description": "", "children": [{"name": "rf", "type": "site", "subtype": "site", "properties": {"name": "rf", "pos": ".16 0 0", "zaxis": "1 0 0"}, "description": "", "children": []}]}]}]}, {"name": "waist_lower", "type": "body", "subtype": "body", "properties": {"name": "waist_lower", "pos": "-.01 0 -.26"}, "description": "", "children": [{"name": "waist_lower", "type": "geom", "subtype": "geom", "properties": {"name": "waist_lower", "fromto": "0 -.06 0 0 .06 0", "size": ".06"}, "description": "", "children": []}, {"name": "abdomen_z", "type": "joint", "subtype": "position", "properties": {"name": "abdomen_z", "pos": "0 0 .065", "axis": "0 0 1", "range": "-45 45", "class": "joint_big_stiff"}, "description": "", "children": []}, {"name": "abdomen_y", "type": "joint", "subtype": "position", "properties": {"name": "abdomen_y", "pos": "0 0 .065", "axis": "0 1 0", "range": "-75 30", "class": "joint_big"}, "description": "", "children": []}, {"name": "pelvis", "type": "body", "subtype": "body", "properties": {"name": "pelvis", "pos": "0 0 -.165"}, "description": "", "children": [{"name": "abdomen_x", "type": "joint", "subtype": "position", "properties": {"name": "abdomen_x", "pos": "0 0 .1", "axis": "1 0 0", "range": "-35 35", "class": "joint_big"}, "description": "", "children": []}, {"name": "butt", "type": "geom", "subtype": "geom", "properties": {"name": "butt", "fromto": "-.02 -.07 0 -.02 .07 0", "size": ".09"}, "description": "", "children": []}, {"name": "thigh_right", "type": "body", "subtype": "body", "properties": {"name": "thigh_right", "pos": "0 -.1 -.04"}, "description": "", "children": [{"name": "hip_x_right", "type": "joint", "subtype": "position", "properties": {"name": "hip_x_right", "axis": "1 0 0", "class": "hip_x"}, "description": "", "children": []}, {"name": "hip_z_right", "type": "joint", "subtype": "position", "properties": {"name": "hip_z_right", "axis": "0 0 1", "class": "hip_z"}, "description": "", "children": []}, {"name": "hip_y_right", "type": "joint", "subtype": "position", "properties": {"name": "hip_y_right", "class": "hip_y"}, "description": "", "children": []}, {"name": "thigh_right", "type": "geom", "subtype": "geom", "properties": {"name": "thigh_right", "fromto": "0 0 0 0 .01 -.34", "class": "thigh"}, "description": "", "children": []}, {"name": "shin_right", "type": "body", "subtype": "body", "properties": {"name": "shin_right", "pos": "0 .01 -.4"}, "description": "", "children": [{"name": "knee_right", "type": "joint", "subtype": "position", "properties": {"name": "knee_right", "class": "knee"}, "description": "", "children": []}, {"name": "shin_right", "type": "geom", "subtype": "geom", "properties": {"name": "shin_right", "class": "shin"}, "description": "", "children": []}, {"name": "foot_right", "type": "body", "subtype": "body", "properties": {"name": "foot_right", "pos": "0 0 -.39"}, "description": "", "children": [{"name": "foot", "type": "camera", "subtype": "camera", "properties": {"name": "foot", "pos": "1 0 0", "xyaxes": "1 0 0 0 1 2", "mode": "trackcom"}, "description": "", "children": []}, {"name": "ankle_y_right", "type": "joint", "subtype": "position", "properties": {"name": "ankle_y_right", "class": "ankle_y"}, "description": "", "children": []}, {"name": "ankle_x_right", "type": "joint", "subtype": "position", "properties": {"name": "ankle_x_right", "class": "ankle_x", "axis": "1 0 .5"}, "description": "", "children": []}, {"name": "foot1_right", "type": "geom", "subtype": "geom", "properties": {"name": "foot1_right", "class": "foot1"}, "description": "", "children": []}, {"name": "foot2_right", "type": "geom", "subtype": "geom", "properties": {"name": "foot2_right", "class": "foot2"}, "description": "", "children": []}]}]}]}, {"name": "thigh_left", "type": "body", "subtype": "body", "properties": {"name": "thigh_left", "pos": "0 .1 -.04"}, "description": "", "children": [{"name": "hip_x_left", "type": "joint", "subtype": "position", "properties": {"name": "hip_x_left", "axis": "-1 0 0", "class": "hip_x"}, "description": "", "children": []}, {"name": "hip_z_left", "type": "joint", "subtype": "position", "properties": {"name": "hip_z_left", "axis": "0 0 -1", "class": "hip_z"}, "description": "", "children": []}, {"name": "hip_y_left", "type": "joint", "subtype": "position", "properties": {"name": "hip_y_left", "class": "hip_y"}, "description": "", "children": []}, {"name": "thigh_left", "type": "geom", "subtype": "geom", "properties": {"name": "thigh_left", "fromto": "0 0 0 0 -.01 -.34", "class": "thigh"}, "description": "", "children": []}, {"name": "shin_left", "type": "body", "subtype": "body", "properties": {"name": "shin_left", "pos": "0 -.01 -.4"}, "description": "", "children": [{"name": "knee_left", "type": "joint", "subtype": "position", "properties": {"name": "knee_left", "class": "knee"}, "description": "", "children": []}, {"name": "shin_left", "type": "geom", "subtype": "geom", "properties": {"name": "shin_left", "fromto": "0 0 0 0 0 -.3", "class": "shin"}, "description": "", "children": []}, {"name": "foot_left", "type": "body", "subtype": "body", "properties": {"name": "foot_left", "pos": "0 0 -.39"}, "description": "", "children": [{"name": "ankle_y_left", "type": "joint", "subtype": "position", "properties": {"name": "ankle_y_left", "class": "ankle_y"}, "description": "", "children": []}, {"name": "ankle_x_left", "type": "joint", "subtype": "position", "properties": {"name": "ankle_x_left", "class": "ankle_x", "axis": "-1 0 -.5"}, "description": "", "children": []}, {"name": "foot1_left", "type": "geom", "subtype": "geom", "properties": {"name": "foot1_left", "class": "foot1"}, "description": "", "children": []}, {"name": "foot2_left", "type": "geom", "subtype": "geom", "properties": {"name": "foot2_left", "class": "foot2"}, "description": "", "children": []}]}]}]}]}]}, {"name": "upper_arm_right", "type": "body", "subtype": "body", "properties": {"name": "upper_arm_right", "pos": "0 -.17 .06"}, "description": "", "children": [{"name": "shoulder1_right", "type": "joint", "subtype": "position", "properties": {"name": "shoulder1_right", "axis": "2 1 1", "class": "shoulder"}, "description": "", "children": []}, {"name": "shoulder2_right", "type": "joint", "subtype": "position", "properties": {"name": "shoulder2_right", "axis": "0 -1 1", "class": "shoulder"}, "description": "", "children": []}, {"name": "upper_arm_right", "type": "geom", "subtype": "geom", "properties": {"name": "upper_arm_right", "fromto": "0 0 0 .16 -.16 -.16", "class": "arm_upper"}, "description": "", "children": []}, {"name": "lower_arm_right", "type": "body", "subtype": "body", "properties": {"name": "lower_arm_right", "pos": ".18 -.18 -.18"}, "description": "", "children": [{"name": "elbow_right", "type": "joint", "subtype": "position", "properties": {"name": "elbow_right", "axis": "0 -1 1", "class": "elbow"}, "description": "", "children": []}, {"name": "lower_arm_right", "type": "geom", "subtype": "geom", "properties": {"name": "lower_arm_right", "fromto": ".01 .01 .01 .17 .17 .17", "class": "arm_lower"}, "description": "", "children": []}, {"name": "hand_right", "type": "body", "subtype": "body", "properties": {"name": "hand_right", "pos": ".18 .18 .18"}, "description": "", "children": [{"name": "hand_right", "type": "geom", "subtype": "geom", "properties": {"name": "hand_right", "zaxis": "1 1 1", "class": "hand"}, "description": "", "children": []}]}]}]}, {"name": "upper_arm_left", "type": "body", "subtype": "body", "properties": {"name": "upper_arm_left", "pos": "0 .17 .06"}, "description": "", "children": [{"name": "shoulder1_left", "type": "joint", "subtype": "position", "properties": {"name": "shoulder1_left", "axis": "-2 1 -1", "class": "shoulder"}, "description": "", "children": []}, {"name": "shoulder2_left", "type": "joint", "subtype": "position", "properties": {"name": "shoulder2_left", "axis": "0 -1 -1", "class": "shoulder"}, "description": "", "children": []}, {"name": "upper_arm_left", "type": "geom", "subtype": "geom", "properties": {"name": "upper_arm_left", "fromto": "0 0 0 .16 .16 -.16", "class": "arm_upper"}, "description": "", "children": []}, {"name": "lower_arm_left", "type": "body", "subtype": "body", "properties": {"name": "lower_arm_left", "pos": ".18 .18 -.18"}, "description": "", "children": [{"name": "elbow_left", "type": "joint", "subtype": "position", "properties": {"name": "elbow_left", "axis": "0 -1 -1", "class": "elbow"}, "description": "", "children": []}, {"name": "lower_arm_left", "type": "geom", "subtype": "geom", "properties": {"name": "lower_arm_left", "fromto": ".01 -.01 .01 .17 -.17 .17", "class": "arm_lower"}, "description": "", "children": []}, {"name": "hand_left", "type": "body", "subtype": "body", "properties": {"name": "hand_left", "pos": ".18 -.18 .18"}, "description": "", "children": [{"name": "hand_left", "type": "geom", "subtype": "geom", "properties": {"name": "hand_left", "zaxis": "1 -1 1", "class": "hand"}, "description": "", "children": []}]}]}]}]}]
	
	_tree.setup(feagi_template, recurse)
	
	
	return
	var XML_parser: XMLParser = XMLParser.new()
	var import_err: Error  = XML_parser.open_buffer(data)

	_success.visible = true
	_failure.visible = false

	if import_err:
		_success.visible = false
		_failure.visible = true
		_error_code.text = "Unable to open given file as an XML!"
		return
	
	

	
